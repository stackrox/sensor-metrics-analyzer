rule_type = "composite"
display_name = "cluster_entities_relationship"
description = "Validate cluster entities relationships"
reviewed = "No, AI-generated"
last_review_by = ""
last_review_on = "never"

[composite_config]

[[composite_config.metrics]]
name = "containers"
source = "rox_sensor_num_containers_in_clusterentities_store"

[[composite_config.metrics]]
name = "endpoints"
source = "rox_sensor_num_endpoints_in_clusterentities_store"

[[composite_config.metrics]]
name = "ips"
source = "rox_sensor_num_ips_in_clusterentities_store"

[[composite_config.checks]]
check_type = "not_zero"
metrics = ["containers", "endpoints", "ips"]
status = "red"
message = "Entities: {containers} containers, {endpoints} endpoints, {ips} IPs - Zero detected!"

[[composite_config.checks]]
check_type = "ratio"
numerator = "endpoints"
denominator = "containers"
min_ratio = 0.5
status = "yellow"
message = "Entities: {containers} containers, {endpoints} endpoints, {ips} IPs - Low endpoint ratio"

[[composite_config.checks]]
check_type = "ratio"
numerator = "ips"
denominator = "endpoints"
min_ratio = 0.5
status = "yellow"
message = "Entities: {containers} containers, {endpoints} endpoints, {ips} IPs - Low IP ratio"

[messages]
green = "Entities: {containers} containers, {endpoints} endpoints, {ips} IPs (healthy ratios)"

[remediation]
red = "Zero entities detected - Sensor cannot see cluster resources. Check Sensor connectivity and permissions."
yellow = "Low entity ratios detected - investigate data pipeline integrity."

acs_versions = ["4.7+", "4.8+", "4.9+"]

